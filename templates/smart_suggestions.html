{% extends "base.html" %}

{% block title %}智慧建議 - {{ child.nickname }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-lightbulb text-warning me-2"></i>
                    {{ child.nickname }} 的個人化學習建議
                </h2>
                <div>
                    <a href="{{ url_for('generate_report', child_id=child.id) }}" class="btn btn-primary me-2">
                        <i class="fas fa-file-pdf me-2"></i>下載分析報告
                    </a>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>返回學習中心
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 學習表現總覽 -->
    <div class="row mb-3 align-items-stretch">
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-radar text-primary me-2"></i>
                        學習表現總覽
                    </h5>
                </div>
                <div class="card-body py-3">
                    <div class="row text-center">
                        <div class="col-md-3 mb-2">
                            <div class="performance-metric compact">
                                <i class="fas fa-book-reader fa-lg text-primary mb-1"></i>
                                <h5 class="mb-0">{{ performance_data.total_sessions }}</h5>
                                <p class="text-muted mb-0 small">總學習次數</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <div class="performance-metric compact">
                                <i class="fas fa-hourglass-half fa-lg text-success mb-1"></i>
                                <h5 class="mb-0">{{ "%.1f" | format(performance_data.total_hours) }}</h5>
                                <p class="text-muted mb-0 small">總學習時數</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <div class="performance-metric compact">
                                <i class="fas fa-brain fa-lg text-info mb-1"></i>
                                <h5 class="mb-0">{{ performance_data.avg_attention }}%</h5>
                                <p class="text-muted mb-0 small">平均專注度</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <div class="performance-metric compact">
                                <i class="fas fa-chart-line fa-lg text-warning mb-1"></i>
                                <h5 class="mb-0">
                                    {% if performance_data.improvement_rate > 0 %}
                                        +{{ performance_data.improvement_rate }}%
                                    {% else %}
                                        {{ performance_data.improvement_rate }}%
                                    {% endif %}
                                </h5>
                                <p class="text-muted mb-0 small">進步幅度</p>
                            </div>
                        </div>
                    </div>
                    
                    {% if performance_data.best_subject %}
                    <div class="mt-2 text-center">
                        <div class="alert alert-success mb-0 py-2">
                            <i class="fas fa-trophy me-2"></i>
                            表現最佳科目：<strong>{{ performance_data.best_subject }}</strong>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- 學習者資訊 -->
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-header py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-user-graduate text-success me-2"></i>
                        學習者資訊
                    </h5>
                </div>
                <div class="card-body py-3">
                    <div class="learner-info compact">
                        <div class="info-item py-2">
                            <i class="fas fa-user-tag me-2"></i>
                            <strong>姓名：</strong>{{ child.nickname }}
                        </div>
                        <div class="info-item py-2">
                            <i class="fas fa-birthday-cake me-2"></i>
                            <strong>年齡：</strong>{{ child.age }} 歲
                        </div>
                        <div class="info-item py-2">
                            <i class="fas fa-venus-mars me-2"></i>
                            <strong>性別：</strong>{{ {'male': '男生', 'female': '女生'}[child.gender] }}
                        </div>
                        <div class="info-item py-2">
                            <i class="fas fa-school me-2"></i>
                            <strong>教育階段：</strong>{{ {'elementary': '國小', 'middle': '國中', 'high': '高中'}[child.education_stage] }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 個人化建議區域 -->
    <div class="row">
        <!-- 年齡適性建議 -->
        {% if suggestions.age_appropriate %}
        <div class="col-lg-6 mb-3">
            <div class="card suggestion-card">
                <div class="card-header bg-primary text-white py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-child me-2"></i>
                        年齡適性建議
                    </h5>
                </div>
                <div class="card-body py-3">
                    {% for suggestion in suggestions.age_appropriate %}
                    <div class="suggestion-item compact">
                        <i class="fas fa-check-circle text-primary me-2"></i>
                        {{ suggestion }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- 學習風格建議 -->
        {% if suggestions.learning_style %}
        <div class="col-lg-6 mb-3">
            <div class="card suggestion-card">
                <div class="card-header bg-success text-white py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-palette me-2"></i>
                        學習風格建議
                    </h5>
                </div>
                <div class="card-body py-3">
                    {% for suggestion in suggestions.learning_style %}
                    <div class="suggestion-item compact">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        {{ suggestion }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- 專注力提升建議 -->
        {% if suggestions.attention_improvement %}
        <div class="col-lg-6 mb-3">
            <div class="card suggestion-card">
                <div class="card-header bg-info text-white py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-brain me-2"></i>
                        專注力提升建議
                    </h5>
                </div>
                <div class="card-body py-3">
                    {% for suggestion in suggestions.attention_improvement %}
                    <div class="suggestion-item compact">
                        <i class="fas fa-check-circle text-info me-2"></i>
                        {{ suggestion }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- 時間規劃建議 -->
        {% if suggestions.schedule %}
        <div class="col-lg-6 mb-3">
            <div class="card suggestion-card">
                <div class="card-header bg-warning text-white py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>
                        時間規劃建議
                    </h5>
                </div>
                <div class="card-body py-3">
                    {% for suggestion in suggestions.schedule %}
                    <div class="suggestion-item compact">
                        <i class="fas fa-check-circle text-warning me-2"></i>
                        {{ suggestion }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- 科目專屬建議 -->
        {% if suggestions.subject_specific %}
        <div class="col-12 mb-3">
            <div class="card suggestion-card">
                <div class="card-header bg-danger text-white py-2">
                    <h5 class="mb-0">
                        <i class="fas fa-book me-2"></i>
                        科目專屬建議
                    </h5>
                </div>
                <div class="card-body py-3">
                    <div class="row">
                        {% for suggestion in suggestions.subject_specific %}
                        <div class="col-md-6 mb-2">
                            <div class="suggestion-item compact">
                                <i class="fas fa-check-circle text-danger me-2"></i>
                                {{ suggestion }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
/* 精簡版效能指標 */
.performance-metric.compact {
    padding: 0.75rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px;
    transition: transform 0.3s ease;
    border: 1px solid rgba(66, 165, 245, 0.1);
}

.performance-metric.compact:hover {
    transform: translateY(-3px);
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
}

.performance-metric.compact h5 {
    font-size: 1.25rem;
    margin-bottom: 0.25rem;
}

.performance-metric.compact p {
    font-size: 0.75rem;
}

/* 精簡版學習者資訊 */
.learner-info.compact {
    font-size: 0.95rem;
}

.info-item {
    border-bottom: 1px solid rgba(66, 165, 245, 0.1);
    display: flex;
    align-items: center;
}

.info-item:last-child {
    border-bottom: none;
}

.info-item i {
    width: 20px;
    text-align: center;
    color: #42a5f5;
}

/* 精簡版建議卡片 */
.suggestion-card {
    height: 100%;
    transition: transform 0.3s ease;
}

.suggestion-card:hover {
    transform: translateY(-3px);
}

.suggestion-item.compact {
    padding: 0.75rem;
    margin-bottom: 0.4rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 6px;
    line-height: 1.5;
    border-left: 3px solid rgba(66, 165, 245, 0.3);
    font-size: 0.9rem;
}

.suggestion-item.compact:last-child {
    margin-bottom: 0;
}

.card-header {
    font-weight: 600;
}

.card-header.bg-primary {
    background: linear-gradient(45deg, #42a5f5, #1e88e5) !important;
}

.card-header.bg-success {
    background: linear-gradient(45deg, #66bb6a, #4caf50) !important;
}

.card-header.bg-info {
    background: linear-gradient(45deg, #26c6da, #00bcd4) !important;
}

.card-header.bg-warning {
    background: linear-gradient(45deg, #ffb74d, #ff9800) !important;
    color: white !important;
}

.card-header.bg-danger {
    background: linear-gradient(45deg, #ef5350, #f44336) !important;
}

/* 響應式設計 */
@media (max-width: 768px) {
    .performance-metric.compact {
        margin-bottom: 0.5rem;
        padding: 0.5rem;
    }
    
    .performance-metric.compact h5 {
        font-size: 1.1rem;
    }
    
    .performance-metric.compact i {
        font-size: 1.25rem !important;
    }
    
    .suggestion-item.compact {
        padding: 0.6rem;
        font-size: 0.85rem;
    }
    
    .info-item {
        font-size: 0.9rem;
        padding: 0.3rem 0;
    }
    
    .col-md-6.mb-2 {
        margin-bottom: 0.5rem !important;
    }
}

@media (max-width: 576px) {
    .performance-metric.compact h5 {
        font-size: 1rem;
    }
    
    .performance-metric.compact i {
        font-size: 1rem !important;
    }
    
    .performance-metric.compact p {
        font-size: 0.7rem;
    }
    
    .suggestion-item.compact {
        padding: 0.5rem;
        font-size: 0.8rem;
    }
    
    .card-header h5 {
        font-size: 0.95rem;
    }
    
    .info-item {
        font-size: 0.85rem;
    }
}
</style>
        padding: 0.4rem 0;
    }
    
    .col-md-6.mb-3 {
        margin-bottom: 1rem !important;
    }
}

@media (max-width: 576px) {
    .performance-metric h4 {
        font-size: 1.1rem;
    }
    
    .performance-metric i {
        font-size: 1.25rem !important;
    }
    
    .performance-metric p {
        font-size: 0.75rem;
    }
    
    .suggestion-item {
        padding: 0.5rem;
        font-size: 0.9rem;
    }
    
    .card-header h5 {
        font-size: 1rem;
    }
    
    .info-item {
        font-size: 0.9rem;
    }
}
</style>
{% endblock %}